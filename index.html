<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>EMEX - Pesquisa de Satisfacao</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root {
        --bg: #0e2a47;
        --card: #0f3356;
        --card-2: #123c67;
        --text: #f4f6fb;
        --muted: #c7d3e6;
        --accent: #ff9f1c;
        --accent-2: #56cfe1;
        --shadow: 0 18px 60px rgba(0, 0, 0, 0.35);
        --border: rgba(255, 255, 255, 0.08);
    }

    * { box-sizing: border-box; }

    body {
        font-family: "Poppins", "Segoe UI", Arial, sans-serif;
        padding: 0;
        margin: 0;
        background: radial-gradient(circle at 20% 20%, rgba(255, 159, 28, 0.12), transparent 25%), radial-gradient(circle at 80% 0%, rgba(86, 207, 225, 0.22), transparent 30%), var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 20px 12px 36px;
    }

    .shell {
        width: 100%;
        max-width: 820px;
        transform: scale(0.95);
        transform-origin: top center;
    }

    .card {
        background: linear-gradient(135deg, var(--card), var(--card-2));
        border-radius: 20px;
        padding: 26px 22px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        backdrop-filter: blur(4px);
    }

    .logo {
        display: block;
        margin: 0 auto 16px;
        width: min(210px, 62vw);
        max-height: 70px;
        object-fit: contain;
        filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.35));
    }

    .tag {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--muted);
        font-size: 13px;
        margin: 2px auto 18px;
    }

    h1 {
        margin: 8px 0 10px;
        font-size: 24px;
        font-weight: 700;
        letter-spacing: 0.2px;
        text-align: center;
    }

    h2 {
        font-size: 20px;
        font-weight: 600;
        margin: 12px 0 10px;
        text-align: center;
    }

    p {
        margin: 0 0 14px;
        color: var(--muted);
        font-size: 16px;
        line-height: 1.55;
        text-align: center;
    }

    .question {
        text-align: left;
        margin: 0 0 14px;
    }

    .nps-scale {
        margin: 18px auto 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 14px 10px;
        max-width: 460px;
    }

    .nps-row {
        display: grid;
        gap: 10px;
        justify-content: center;
        justify-items: center;
    }

    .nps-row-top {
        grid-template-columns: repeat(6, minmax(44px, 1fr));
    }

    .nps-row-bottom {
        grid-template-columns: repeat(5, minmax(44px, 1fr));
        padding: 0 6px;
    }

    .score-btn {
        border: none;
        border-radius: 10px;
        width: 100%;
        aspect-ratio: 1 / 1;
        min-width: 44px;
        max-width: 60px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 17px;
        font-weight: 700;
        color: #fff;
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
    }

    .score-btn:hover { transform: translateY(-1px) scale(1.01); opacity: 0.97; }
    .score-btn.selected { outline: 2px solid rgba(0, 0, 0, 0.08); box-shadow: 0 10px 22px rgba(0, 0, 0, 0.2); transform: translateY(-1px) scale(1.015); }

    .legend {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--muted);
        font-size: 14px;
        margin: 4px 6px 20px;
    }

    .textarea {
        width: 100%;
        min-height: 120px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 12px 14px;
        font-size: 15px;
        resize: vertical;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
    }

    .actions {
        margin-top: 16px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn {
        padding: 12px 18px;
        border-radius: 12px;
        border: none;
        color: #0b223a;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.12s ease;
        min-width: 160px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--accent), #ff6b35);
        box-shadow: 0 12px 26px rgba(255, 111, 53, 0.35);
    }

    .btn:hover { transform: translateY(-2px); }

    .thank-you {
        margin-top: 22px;
        text-align: center;
        padding: 16px 14px;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--border);
        display: none;
    }

    .footer {
        text-align: center;
        margin-top: 18px;
        font-size: 13px;
        color: var(--muted);
    }

    .screen {
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 180ms ease, transform 180ms ease;
        max-height: 0;
        overflow: hidden;
        pointer-events: none;
    }

    .screen.active {
        opacity: 1;
        transform: translateY(0);
        max-height: 1400px;
        pointer-events: auto;
    }

    .legend-wrapper {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 18px 16px 6px;
        margin-top: 12px;
    }

    @media (max-width: 520px) {
        body { padding: 22px 12px 36px; }
        .card { padding: 22px 18px; }
        h1 { font-size: 23px; }
        h2 { font-size: 18px; }
        .actions { flex-direction: column; }
        .actions .btn { width: 100%; }
    }

    @media (max-width: 420px) {
        .shell { transform: scale(0.92); }
        .nps-scale { padding: 12px 8px; gap: 8px; }
        .nps-row { gap: 8px; }
        .nps-row-top { grid-template-columns: repeat(6, minmax(40px, 1fr)); }
        .nps-row-bottom { grid-template-columns: repeat(5, minmax(40px, 1fr)); padding: 0 4px; }
        .score-btn { min-width: 40px; max-width: 54px; font-size: 16px; }
    }
</style>
</head>

<body>

<div class="shell">
    <div class="card">
        <img class="logo" src="LogoEmex.png" alt="EMEX LOGO">
        <div class="tag">Pesquisa de satisfacao - NPS</div>

        <div id="screenScore" class="screen active">
            <h1>Queremos ouvir você!</h1>
            <p class="question">De 0 a 10, qual a probabilidade de você indicar a EMEX para um amigo ou colega?</p>

            <div class="nps-scale">
                <div class="nps-row nps-row-top" id="npsRowTop"></div>
                <div class="nps-row nps-row-bottom" id="npsRowBottom"></div>
            </div>
            <div class="legend">
                <span>Pouco provavel</span>
                <span>Muito provavel</span>
            </div>
        </div>

        <div id="screenComment" class="screen">
            <h2 id="commentTitle">Queremos ouvir mais</h2>
            <p id="commentSubtitle">Conte um pouco sobre sua experiencia.</p>
            <textarea class="textarea" id="comentario" placeholder="Digite sua resposta..."></textarea>
            <div class="actions">
                <button class="btn btn-primary" id="enviar">Enviar</button>
            </div>
        </div>

        <div class="thank-you" id="thankYou">
            <p id="mensagemFinal">Obrigado! Seu feedback e muito importante para nos.</p>
        </div>
    </div>

    <div class="footer">
        Desenvolvido por <b>Joao Porto</b>
    </div>
</div>

<script>
    const googleReviewLink = "https://g.page/r/CbtxDmKG0tleEAE/review";
    const whatsappNumber = "558000243200";
    const whatsappMessage = encodeURIComponent("Falar com o setor sobre a pesquisa!");

    // Se quiser registrar no Google Forms, coloque o formResponse e os IDs dos campos
    const googleFormsAction = ""; // ex: "https://docs.google.com/forms/d/e/FORM_ID/formResponse"
    const googleFormsFields = {
        code: "",    // ex: "entry.111111"
        score: "",   // ex: "entry.789012"
        comment: ""  // ex: "entry.345678"
    };

    // Opcional: endpoint de Apps Script / webhook para gravar direto no Google Sheets
    const googleSheetsEndpoint = "https://script.google.com/macros/s/AKfycbzBZSRgLJmTExNw63S-iSO5uPMm0aCY8D8tBXf5W1seMqwxfsb7cOOe8qEcEz73JFngOA/exec";

    const urlParams = new URLSearchParams(window.location.search);
    const codigo = urlParams.get("codigo") || "";

    // Monta botoes NPS com cores de 0 a 10 em duas linhas (0-5 / 6-10)
    const npsRowTop = document.getElementById("npsRowTop");
    const npsRowBottom = document.getElementById("npsRowBottom");
    const colors = ["#b11922", "#c22327", "#d33726", "#e25c26", "#f08b27", "#f5b12f", "#d8c830", "#c6d934", "#9bcf3b", "#6cbb3e", "#46a64a"];
    let selectedScore = null;

    const screenScore = document.getElementById("screenScore");
    const screenComment = document.getElementById("screenComment");
    const commentTitle = document.getElementById("commentTitle");
    const commentSubtitle = document.getElementById("commentSubtitle");
    const thankYou = document.getElementById("thankYou");
    const mensagemFinal = document.getElementById("mensagemFinal");
    const comentario = document.getElementById("comentario");

    colors.forEach((color, index) => {
        const btn = document.createElement("button");
        btn.className = "score-btn";
        btn.style.background = color;
        btn.textContent = index;
        btn.setAttribute("aria-label", `Nota ${index}`);
        btn.addEventListener("click", () => {
            selectedScore = index;
            document.querySelectorAll(".score-btn").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            screenScore.classList.remove("active");
            screenComment.classList.add("active");

            if (selectedScore >= 9) {
                commentTitle.textContent = "Uau! Porque merecemos essa otima nota?";
                commentSubtitle.textContent = "Conte os pontos altos da sua experiencia.";
            } else if (selectedScore >= 7) {
                commentTitle.textContent = "O que podemos melhorar para ganhar um 10?";
                commentSubtitle.textContent = "Sua dica ajuda a priorizar as proximas melhorias.";
            } else {
                commentTitle.textContent = "Poxa! Nos conte o que aconteceu.";
                commentSubtitle.textContent = "Queremos corrigir o mais rapido possivel.";
            }

            comentario.scrollIntoView({ behavior: "smooth", block: "start" });
            comentario.focus({ preventScroll: true });
        });

        if (index <= 5) {
            npsRowTop.appendChild(btn);
        } else {
            npsRowBottom.appendChild(btn);
        }
    });

    const submitToGoogleForms = async ({ code, score, comment }) => {
        if (!googleFormsAction || !googleFormsFields.score || !googleFormsFields.comment) {
            return;
        }
        const data = new FormData();
        if (googleFormsFields.code) data.append(googleFormsFields.code, code);
        data.append(googleFormsFields.score, score);
        data.append(googleFormsFields.comment, comment);
        try {
            await fetch(googleFormsAction, { method: "POST", mode: "no-cors", body: data });
        } catch (err) {
            console.error("Falha ao enviar para Google Forms", err);
        }
    };

    const submitToSheet = async ({ code, score, comment }) => {
        if (!googleSheetsEndpoint) return;
        try {
            await fetch(googleSheetsEndpoint, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ code, score, comment })
            });
        } catch (err) {
            console.error("Falha ao enviar para Google Sheets", err);
        }
    };

    const openWhatsApp = () => {
        alert("Sera necessario transferir o seu atendimento para o nosso setor responsavel para resolvermos esse problema!\n\nAssim que chegar na tela do WhatsApp, aperte para enviar a mensagem que vamos te atender em segundos!");
        const waLink = `https://wa.me/${whatsappNumber}?text=${whatsappMessage}`;
        window.location.href = waLink;
    };

    const openGoogleReview = () => {
        window.location.href = googleReviewLink;
    };

    document.getElementById("enviar").addEventListener("click", async () => {
        if (selectedScore === null) {
            alert("Escolha uma nota de 0 a 10.");
            return;
        }

        const texto = comentario.value.trim();
        thankYou.style.display = "block";
        screenComment.classList.remove("active");

        await submitToGoogleForms({ code: codigo, score: selectedScore, comment: texto });
        await submitToSheet({ code: codigo, score: selectedScore, comment: texto });

        if (selectedScore <= 6) {
            mensagemFinal.innerHTML = `Sentimos muito! Vamos te atender no WhatsApp para resolver.`;
            setTimeout(openWhatsApp, 500);
            return;
        }

        if (selectedScore === 10) {
            mensagemFinal.innerHTML = `Obrigado! Voce sera redirecionado para avaliar no Google.`;
            setTimeout(openGoogleReview, 500);
            return;
        }

        mensagemFinal.innerHTML = `Obrigado! Sua nota <b>${selectedScore}</b> foi registrada.`;
    });
</script>

</body>
</html>
